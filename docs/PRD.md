## X 协议爬虫 PRD（整理版）

ALIGNMENT_LOCK: true
ALIGNMENT_DATE: 2026-02-19

### 1. 项目目标
开发一个可由用户自行操作的 X 协议爬虫脚本，用于按账号和关键词检索帖子，并输出结构化数据。

### 2. 运行方式
命令行运行：

```bash
python run.py <start_date> <end_date>
```

日期格式固定为 `YYYY_M_D`，例如：

```bash
python run.py 2021_9_1 2025_12_30
```

### 3. 输入来源
1. 账号列表文件：`D:\\Develop\\masterpiece\\Spider\\Website\\x\\docs\\Accounts.txt`  
每行一个 X 账号主页链接（例如 `https://x.com/NBCOlympics`）。
2. 关键词文件：`D:\\Develop\\masterpiece\\Spider\\Website\\x\\docs\\Keys.txt`  
每行一个关键词规则。
   - 行内多词按 AND 逻辑（需全部命中）。
   - 行间按 OR 逻辑（任一规则命中即落盘）。
   - 行内分隔符支持：空格、`,`、`，`、`+`。

### 4. 功能需求
1. 按账号维度执行“账号内关键词搜帖”。
2. 支持用户通过命令行自定义检索时间范围。
3. 时间过滤按发帖时间执行，开始日期和结束日期均包含边界当天。
4. 对每条命中帖子采集以下信息：
   - 发帖时间
   - 文本内容
   - 帖文链接
   - 浏览量
   - 点赞数
   - 转发数
   - 评论数
5. 若帖子为转发/引用，需额外抓取被转发（或被引用）帖文文本内容。
6. 输出格式必须为 `jsonl`（一行一条记录）。
7. 无结果或请求失败时，不中断整体任务，记录错误信息。

### 5. 登录态与稳定性要求
1. 走官方登录流程获取登录态。
2. 登录成功后保存 cookie 到本地，后续复用。
3. 运行中若登录态失效，自动触发重新登录并更新本地 cookie 后继续抓取。
4. 请求失败需具备重试能力（含限流/临时错误场景）。
5. 需支持配额感知调度：当配额临近耗尽时，按 `x-rate-limit-reset` 主动等待后再继续请求。

### 6. 输出字段（已确认）
- `account`
- `keyword`
- `post_time`
- `text`
- `post_url`
- `views`
- `likes`
- `reposts`
- `replies`
- `quoted_text`（承载被转发/被引用帖文文本）
- `error`

### 7. 范围边界
1. 本项目只做协议抓取，不做页面级数据采集作为主方案。
2. 抓取对象范围为主帖与转发，不包含回复线程抓取。
3. 互动数和浏览量按页面原始字符串输出。

